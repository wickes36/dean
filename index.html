<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beau's Funny Name Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Oswald', sans-serif;
            background-color: #101010;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23222222' fill-opacity='0.4'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            text-transform: uppercase;
        }
        
        .main-card {
            background-color: #1a1a1a;
            border: 1px solid #444;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .result-card {
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%);
        }

        .generate-btn {
            clip-path: polygon(0 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 20px 100%, 0 calc(100% - 20px));
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #f59e0b; /* Amber 500 */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="text-center p-8 max-w-lg w-full mx-auto main-card">
        <!-- Application Title -->
        <h1 class="text-4xl md:text-5xl font-bold mb-2 tracking-wider">BEAU'S</h1>
        <h2 class="text-3xl md:text-4xl font-light mb-8 text-amber-400 tracking-widest" style="margin-bottom: 0px;">"GENERATE ME SOME DEANS"</h2>
                <h1 class="text-4xl md:text-5xl font-bold mb-2 tracking-wider">APP</h1>

        <p class="text-gray-400 mb-8 text-sm font-sans normal-case tracking-normal">Engage the AI. Generate new surname variants for operative 'DEAN'.</p>

        <!-- Generate Button -->
        <button id="generateBtn" class="bg-amber-500 hover:bg-white text-black hover:text-black font-bold py-4 px-8 text-xl tracking-widest w-full generate-btn">
            GENERATE 'DEANS'
        </button>

        <!-- Loading Spinner (hidden by default) -->
        <div id="spinner" class="spinner mx-auto my-8 hidden"></div>

        <!-- Results Area -->
        <div id="results" class="mt-8 text-left space-y-3">
            <!-- Generated names will appear here -->
        </div>
    </div>

    <script>
        // DOM element references
        const generateBtn = document.getElementById('generateBtn');
        const spinner = document.getElementById('spinner');
        const resultsContainer = document.getElementById('results');

        // Event listener for the generate button
        generateBtn.addEventListener('click', generateNames);

        /**
         * Fetches funny surnames by calling our secure Netlify serverless function.
         */
        async function generateNames() {
            spinner.classList.remove('hidden');
            resultsContainer.innerHTML = '';
            generateBtn.disabled = true;
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                // This URL points to our serverless function, not the Google API
                const response = await fetch('/.netlify/functions/generate-names');

                // If the response is not OK, handle potential HTML errors instead of just JSON
                if (!response.ok) {
                    let errorMessage = `Error: ${response.status} ${response.statusText}`;
                    const contentType = response.headers.get("content-type");
                    if (contentType && contentType.includes("application/json")) {
                        const errorData = await response.json();
                        errorMessage = errorData.error || `HTTP error! status: ${response.status}`;
                    } else {
                        // This handles cases where Netlify returns an HTML error page (e.g., 404)
                        console.error("Received a non-JSON error response from the server.");
                        errorMessage = "The server function could not be reached. Please ensure it's deployed correctly.";
                    }
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                const surnames = data.surnames || [];

                if (surnames.length > 0) {
                    displayNames(surnames);
                } else {
                    resultsContainer.innerHTML = '<p class="text-red-500 text-center font-sans normal-case">AI OFFLINE. NO NAMES GENERATED. TRY AGAIN.</p>';
                }

            } catch (error) {
                console.error('Error generating names:', error);
                resultsContainer.innerHTML = `<p class="text-red-500 text-center font-sans normal-case">${error.message}</p>`;
            } finally {
                spinner.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        /**
         * Displays the generated names.
         * @param {string[]} surnames - An array of surnames to display.
         */
        function displayNames(surnames) {
            surnames.forEach(surname => {
                const fullName = `Dean ${surname}`;
                const nameElement = document.createElement('div');
                nameElement.className = 'bg-gray-800 p-4 flex justify-between items-center result-card border-l-4 border-amber-500';
                
                const nameText = document.createElement('span');
                nameText.textContent = fullName;
                nameText.className = 'text-2xl tracking-wider';

                const copyButton = document.createElement('button');
                copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
                copyButton.className = 'text-gray-400 hover:text-amber-400 transition-colors duration-200';
                copyButton.title = 'Copy name';
                copyButton.onclick = () => copyToClipboard(fullName, copyButton);

                nameElement.appendChild(nameText);
                nameElement.appendChild(copyButton);
                resultsContainer.appendChild(nameElement);
            });
        }

        /**
         * Copies text to the clipboard and provides user feedback.
         * @param {string} text - The text to copy.
         * @param {HTMLElement} buttonElement - The button that was clicked.
         */
        function copyToClipboard(text, buttonElement) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                buttonElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
                buttonElement.title = 'Copied!';
                setTimeout(() => {
                    buttonElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
                    buttonElement.title = 'Copy name';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
            document.body.removeChild(textarea);
        }
    </script>

</body>
</html>
